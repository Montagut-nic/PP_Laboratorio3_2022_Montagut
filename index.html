<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        .hidden {
            display: none;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
    </style>
    <script type="text/javascript">
        const initialData = '[{"id":1, "nombre":"Clark", "apellido":"Kent", "edad":45, "alterego":"Superman", "ciudad":"Metropolis", "publicado":2002},{"id":2, "nombre":"Bruce", "apellido":"Wayne", "edad":35, "alterego":"Batman", "ciudad":"Gotica", "publicado":20012},{"id":3, "nombre":"Bart", "apellido":"Alen", "edad":30, "alterego":"Flash", "ciudad":"Central", "publicado":2017},{"id":4, "nombre":"Lex", "apellido":"Luthor", "edad":18, "enemigo":"Superman", "robos":500, "asesinatos":7},{"id":5, "nombre":"Harvey", "apellido":"Dent", "edad":20, "enemigo":"Batman", "robos":750, "asesinatos":2},{"id":666, "nombre":"Celina", "apellido":"kyle", "edad":23, "enemigo":"Batman", "robos":25, "asesinatos":1}]';
        class Persona {

            constructor(id,nombre,apellido,edad){
                this.id=parseInt(isNaN(id) ? 0 : id);
                this.nombre= nombre ? nombre : "-";
                this.apellido= apellido ? apellido : "-";
                this.edad= parseInt(isNaN(edad) ? 0 : edad);
            }

        }

        class Heroe extends Persona {
            constructor(id,nombre,apellido,edad,alterego,ciudad,publicado){
                super(id,nombre,apellido,edad);
                this.alterego=alterego ? alterego : "-";
                this.ciudad=ciudad ? ciudad : "-";
                this.publicado= parseInt(publicado > 1940 ? publicado : 1941);
            }
        }

        class Villano extends Persona{
            constructor(id,nombre,apellido,edad,enemigo,robos,asesinatos){
                super(id,nombre,apellido,edad);
                this.enemigo=enemigo ? enemigo : "-";
                this.robos= parseInt(robos > 0 ? robos : 1);
                this.asesinatos= parseInt(asesinatos > 0 ? asesinatos : 1);
            }
        }
        
        let personas = [];
    </script>
    
    <title>Primer Parcial Laboratorio 3 2022 Montagut</title>
</head>
<body>
    <section name="form_datos" id="form_datos">
        <h1>Form Datos</h1>
        <section class="filtrado">
            <label>Filtrar por:</label>
            <select name="filtro" id="filtro">
                <option value="todos" selected>Todos</option>
                <option value="heroe">Heroe</option>
                <option value="villano">Villano</option>            
            </select>
        </section>
        <section class="promedio_edad">
            <label for="txt_edadProm">Calcular edad promedio:</label>
            <input type="number" readonly name="txt_edadProm" id="txt_edadProm">
            <button value="Calcular" class="button btn_calcular">Calcular</button>
        </section>
        <section class="mostrar_cols">
            <h2>Mostrar columnas</h2>
            <div class="mostrar_fila">
                <div class="mostrar_id">
                    <input type="checkbox" checked name="id" id="p_id">
                    <label for="p_id">ID</label>
                </div>
                <div class="mostrar_nombre">
                    <input type="checkbox" checked name="nombre" id="p_nombre">
                    <label for="p_nombre">Nombre</label>
                </div>
                <div class="mostrar_apellido">
                    <input type="checkbox" checked name="apellido" id="p_apellido">
                    <label for="p_apellido">Apellido</label>
                </div>
                <div class="mostrar_edad">
                    <input type="checkbox" checked name="edad" id="p_edad">
                    <label for="p_edad">Edad</label>
                </div>
                <div class="mostrar_alterego">
                    <input type="checkbox" checked name="alterego" id="p_alterego">
                    <label for="p_alterego">AlterEgo</label>
                </div>
                <div class="mostrar_ciudad">
                    <input type="checkbox" checked name="ciudad" id="p_ciudad">
                    <label for="p_ciudad">Ciudad</label>
                </div>
                <div class="mostrar_publicado">
                    <input type="checkbox" checked name="publicado" id="p_publicado">
                    <label for="p_publicado">Publicado</label>
                </div>
                <div class="mostrar_enemigo">
                    <input type="checkbox" checked name="enemigo" id="p_enemigo">
                    <label for="p_enemigo">Enemigo</label>
                </div>
                <div class="mostrar_robos">
                    <input type="checkbox" checked name="robos" id="p_robos">
                    <label for="p_robos">Robos</label>
                </div>
                <div class="mostrar_asesinatos">
                    <input type="checkbox" checked name="asesinatos" id="p_asesinatos">
                    <label for="p_asesinatos">Asesinatos</label>
                </div>
            </div>
        </section>
        <table name="tabla">
            <thead>
                <tr id="filter_handler">
                    <th class="h_id">ID</th>
                    <th class="h_nombre">Nombre</th>
                    <th class="h_apellido">Apellido</th>
                    <th class="h_edad">Edad</th>
                    <th class="h_alterego">AlterEgo</th>
                    <th class="h_ciudad">Ciudad</th>
                    <th class="h_publicado">Publicado</th>
                    <th class="h_enemigo">Enemigo</th>
                    <th class="h_robos">Robos</th>
                    <th class="h_asesinatos">Asesinatos</th>
                </tr>
            </thead>
            <tbody id="tr_body">
            </tbody>
        </table>
    
    <button value="agregar" class="btn" id="btn_agregar">Agregar</button>
    </section>
    <section name="form_ABM" id="form_ABM">
        <div>
            <h1>Formulario ABM</h1>
            <div class="group">
                <label for="abm_id">ID: </label>
                <input type="text" name="abm_id" id="abm_id">
            </div>
            <div class="group">
                <label for="abm_nombre">Nombre: </label>
                <input type="text" name="abm_nombre" id="abm_nombre">
            </div>
            <div class="group">
                <label for="abm_apellido">Apellido: </label>
                <input type="text" name="abm_apellido" id="abm_apellido">
            </div>
            <div class="group">
                <label for="abm_edad">Edad: </label>
                <input type="text" name="abm_edad" id="abm_edad">
            </div>
            <div class="group">
                <label for="abm_tipo">Tipo: </label>
                <select name="abm_tipo" id="abm_tipo">
                    <option value="heroe" selected>Heroe</option>
                    <option value="villano">Villano</option>
                </select>
            </div>
            <div class="heroe" id="heroe_group">
                <div class="group">
                    <label for="abm_alterego">AlterEgo: </label>
                    <input type="text" name="abm_alterego" id="abm_alterego">
                </div>
                <div class="group">
                    <label for="abm_ciudad">Ciudad: </label>
                    <input type="text" name="abm_ciudad" id="abm_ciudad">
                </div>
                <div class="group">
                    <label for="abm_publicado">Publicado: </label>
                    <input type="text" name="abm_publicado" id="abm_publicado">
                </div>
            </div>
            <div class="villano hidden" id="villano_group">
                <div class="group">
                    <label for="abm_enemigo">Enemigo: </label>
                    <input type="text" name="abm_enemigo" id="abm_enemigo">
                </div>
                <div class="group">
                    <label for="abm_robos">Robos: </label>
                    <input type="text" name="abm_robos" id="abm_robos">
                </div>
                <div class="group">
                    <label for="abm_asesinatos">Asesinatos: </label>
                    <input type="text" name="abm_asesinatos" id="abm_asesinatos">
                </div>
            </div>
        </div>
        <div class="group btn_group">
            <button value="alta" class="button" id="alta_btn">Alta</button>
            <button value="mod" class="button" id="mod_btn">Modificar</button>            
            <button value="baja" class="button" id="baja_btn">Eliminar</button>        
            <button value="can" class="button" id="can_btn">Cancelar</button>        
        </div>
    </section>

    <script type="text/javascript">

        const form_datos = document.getElementById("form_datos");
        const form_abm = document.getElementById("form_ABM");
        const abm_id = document.getElementById("abm_id");
        const abm_nombre = document.getElementById("abm_nombre");
        const abm_apellido = document.getElementById("abm_apellido");
        const abm_edad = document.getElementById("abm_edad");
        const abm_tipo = document.getElementById("abm_tipo");
        const abm_alterego = document.getElementById("abm_alterego");
        const abm_ciudad = document.getElementById("abm_ciudad");
        const abm_publicado = document.getElementById("abm_publicado");
        const abm_enemigo = document.getElementById("abm_enemigo");
        const abm_robos = document.getElementById("abm_robos");
        const abm_asesinatos = document.getElementById("abm_asesinatos");

        const filter = document.getElementById('filtro');
        const tr_body = document.getElementById("tr_body");
        const p_id = document.getElementById("p_id");
        const p_nombre = document.getElementById("p_nombre");
        const p_apellido = document.getElementById("p_apellido");
        const p_edad = document.getElementById("p_edad");
        const p_alterego = document.getElementById("p_alterego");
        const p_ciudad = document.getElementById("p_ciudad");
        const p_publicado = document.getElementById("p_publicado");
        const p_enemigo = document.getElementById("p_enemigo");
        const p_robos = document.getElementById("p_robos");
        const p_asesinatos = document.getElementById("p_asesinatos");

        const h_id = document.querySelector('.h_id');
        const h_nombre = document.querySelector('.h_nombre');
        const h_apellido = document.querySelector('.h_apellido');
        const h_edad = document.querySelector('.h_edad');
        const h_alterego = document.querySelector('.h_alterego');
        const h_ciudad = document.querySelector('.h_ciudad');
        const h_publicado = document.querySelector('.h_publicado');
        const h_enemigo = document.querySelector('.h_enemigo');
        const h_robos = document.querySelector('.h_robos');
        const h_asesinatos = document.querySelector('.h_asesinatos');

        const btn_agregar = document.getElementById("btn_agregar");
        const can_btn = document.getElementById("can_btn");

        const getData = () => {
            for (let persona of JSON.parse(initialData)) {
                if (persona.hasOwnProperty("id") && persona.hasOwnProperty("nombre")
                    && persona.hasOwnProperty("apellido") && persona.hasOwnProperty("edad")) {
                    if (persona.hasOwnProperty("alterego")) {
                        let heroe = new Heroe(persona.id, persona.nombre, persona.apellido, persona.edad, persona.alterego, persona.ciudad, persona.publicado);
                        personas.push(heroe);
                    } else if (persona.hasOwnProperty("enemigo")) {
                        let villano = new Villano(persona.id, persona.nombre, persona.apellido, persona.edad, persona.enemigo, persona.robos, persona.asesinatos);
                        personas.push(villano);
                    }
                }
            }
        }

        const loadTableData = (persona) => {
                tr_body.innerHTML += `
                <tr>
                    ${p_id.checked ? `<td class="h_id">${persona.id}</td>` : ''}
                    ${p_nombre.checked ? `<td>${persona.nombre}</td>` : ''}
                    ${p_apellido.checked ? `<td>${persona.apellido}</td>` : ''}
                    ${p_edad.checked ? `<td>${persona.edad}</td>` : ''}
                    ${p_alterego.checked ? `<td>${persona.alterego ? persona.alterego : '-'}</td>` : ''}
                    ${p_ciudad.checked ? `<td>${persona.ciudad ? persona.ciudad : '-'}</td>` : ''}
                    ${p_publicado.checked ? `<td>${persona.publicado ? persona.publicado : '-'}</td>` : ''}
                    ${p_enemigo.checked ? `<td>${persona.enemigo ? persona.enemigo : '-'}</td>` : ''}
                    ${p_robos.checked ? `<td>${persona.robos ? persona.robos : '-'}</td>` : ''}
                    ${p_asesinatos.checked ? `<td>${persona.asesinatos ? persona.asesinatos : '-'}</td>` : ''}
                </tr>
            `;
        }

        const personasMap = (filter) => {
            tr_body.innerHTML = '';
            personas.map(value => {
                switch (filter) {
                    case 'todos':
                        loadTableData(value);
                        break;
                    case 'heroe':
                        value.alterego && value.ciudad && value.publicado && loadTableData(value);
                        break;
                    case 'villano':
                        value.enemigo && value.robos && value.asesinatos && loadTableData(value);
                        break;
                }
            });
        }

        window.onload = () => {
            getData();
            personasMap(filter.value);
        };

        filter.addEventListener('change', () => {
            personasMap(filter.value);
        });

        abm_tipo.addEventListener("change", () => {
            const heroe = document.querySelector(".heroe");
            const villano = document.querySelector(".villano");
            heroe.classList.toggle("hidden");
            villano.classList.toggle("hidden");
        });

        p_id.addEventListener('click', (e) => {
            if (p_id.checked) {
                h_id.style.removeProperty("display");
                personasMap(filter.value);
            } else {
                h_id.style.display = 'none';
                personasMap(filter.value);
            }
        });
        p_nombre.addEventListener('click', (e) => {
            if (p_nombre.checked) {
                h_nombre.style.removeProperty("display");
                personasMap(filter.value);
            } else {
                h_nombre.style.display = 'none';
                personasMap(filter.value);
            }
        });
        p_apellido.addEventListener('click', (e) => {
            if (p_apellido.checked) {
                h_apellido.style.removeProperty("display");
                personasMap(filter.value);
            } else {
                h_apellido.style.display = 'none';
                personasMap(filter.value);
            }
        });
        p_edad.addEventListener('click', (e) => {
            if (p_edad.checked) {
                h_edad.style.removeProperty("display");
                personasMap(filter.value);
            } else {
                h_edad.style.display = 'none';
                personasMap(filter.value);
            }
        });
        p_alterego.addEventListener('click', (e) => {
            if (p_alterego.checked) {
                h_alterego.style.removeProperty("display");
                personasMap(filter.value);
            } else {
                h_alterego.style.display = 'none';
                personasMap(filter.value);
            }
        });
        p_ciudad.addEventListener('click', (e) => {
            if (p_ciudad.checked) {
                h_ciudad.style.removeProperty("display");
                personasMap(filter.value);
            } else {
                h_ciudad.style.display = 'none';
                personasMap(filter.value);
            }
        });
        p_publicado.addEventListener('click', (e) => {
            if (p_publicado.checked) {
                h_publicado.style.removeProperty("display");
                personasMap(filter.value);
            } else {
                h_publicado.style.display = 'none';
                personasMap(filter.value);
            }
        });
        p_enemigo.addEventListener('click', (e) => {
            if (p_enemigo.checked) {
                h_enemigo.style.removeProperty("display");
                personasMap(filter.value);
            } else {
                h_enemigo.style.display = 'none';
                personasMap(filter.value);
            }
        });
        p_robos.addEventListener('click', (e) => {
            if (p_robos.checked) {
                h_robos.style.removeProperty("display");
                personasMap(filter.value);
            } else {
                h_robos.style.display = 'none';
                personasMap(filter.value);
            }
        });
        p_asesinatos.addEventListener('click', (e) => {
            if (p_asesinatos.checked) {
                h_asesinatos.style.removeProperty("display");
                personasMap(filter.value);
            } else {
                h_asesinatos.style.display = 'none';
                personasMap(filter.value);
            }
        });
    </script>
</body>
</html>